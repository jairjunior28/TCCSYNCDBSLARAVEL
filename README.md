TCC SYNCDBS LARAVEL - Desenvolvimento de Aplicação Web CLoud Para sincronização de dados entre bases distintas.


A implantação de um sistema Web Cloud, envolve inicialmente a definição de parâmetros de sua utilização, tais como Host, Usuário, senha do banco de dados, nome do banco de dados. E deve ser implantado por um profissional habilitado que tenha conhecimento de bancos de dados preferencialmente. 
	Para implantação do sistema desenvolvido inicialmente é necessário a criação de um banco de dados que pode ser feito tanto pelo cmd (prompt de comando do Windows), no shell em distribuições com Kernel Linux/Unix. O que pode ser feito de forma bem simples.
	O sistema desenvolvido foi escrito na linguagem PHP, utilizando o framework Laravel na versão 5.2. O Laravel é um framework que vem sendo largamente utilizada no desenvolvimento de aplicações Web Cloud. Desenvolvido por Taylor Otwell (2016). O Laravel foi criado em 2011, por Taylor Otwell, um Framework em PHP que e utilizado para desenvolvimento web, (Framework é uma ferramenta utilizada por desenvolvedores que incrementa códigos entre muitos projetos de programas assim concede uma funcionalidade maior.) Laravel utiliza MVC como arquitetura, e possui como principal característica auxiliar a elaboração de aplicações seguras de forma rápida, já que a framework induz ao uso de boas práticas de programação.
	O Banco de dados do Laravel possui implementação simples, chamada Eloquent ORM, é um instrumento que vem trazendo várias funcionalidades. Com configuração simples e com pouco código, assim podemos trabalhar com Banco de Dados.
	A Framework Laravel utiliza o Blade, que é um mecanismo de template, traz uma grande série de ferramentas que auxiliam a criação de interfaces gráficas de forma rápida e evitando duplicação de códigos.
	Para quem já utilizou outras Frameworks não haverá dificuldade para usa o Laravel, pois ele trabalha com muitas funcionalidades bem semelhantes, em exemplo o Ruby on Rails, são basicamente iguais em quase tudo. Até mesmo quem não possui nenhuma familiaridade com Frameworks, pode usar o Laravel, já que ele tem uma ótima documentação.
	Os requerimentos para o uso do Laravel, e basicamente os mesmos para quem programa sem frameworks, basicamente e preciso de uma estrutura de banco de dados, por exemplo o MySQL, e um servidor Apache, como o XAMPP ou o EasyPHP.
	
	Para obter os arquivos do projeto é necessário que tenha o composer e o git instalados na máquina e preferencialmente que esteja no path, assim como o curl que será utilizado na última etapa. Então no cmd conforme imagem 3 utilize o comando: git clone https://github.com/jairjunior28/TCCSYNCDBSLARAVEL tccsyncdbslaravel para clonar a aplicação. A aplicação está disponível em https://github.com/jairjunior28/TCCSYNCDBSLARAVEL.  
 


	O próximo passo envolve a configuração do arquivo .env localizado na pasta raiz da aplicação. Este arquivo é responsável pelas principais configurações da aplicação, é neste arquivo onde será definido o banco de dados que será utilizada na aplicação Web Cloud, usuário, senha. Este arquivo tem outras configurações referente a envio de e dentre outros o qual não é o foco da nossa aplicação. .
  
	Feito a configuração deste arquivo será necessário o uso do cmd (prompt de comandos do Windows) ou Shell no Linux. Sendo necessário acessar a pasta raiz do projeto para etapa de criação de banco de dados da aplicação Web Cloud. Para esta etapa é recomendado que se esteja utilizando a versão do PHP 5.5 ou superior, pois nas versões inferiores não é possível executar o php.exe em linha de comando.  Será necessário que o arquivo php.exe esteja ajustado no path no caso de plataforma Windows, caso não esteja no path existe forma de acessar sabendo o caminho do arquivo.
	Inicialmente no cmd (prompt de comando do Windows) ou shell será executado o comando na pasta da aplicação: php artisan key:generate, este comando irá definir uma chave para a aplicação, tornando as sessões de usuários e outros dados criptografados seguros, conforme OTWELL (2016).
	Estando com a chave da aplicação gerada, rodar o comando: php artisan migrate, que irá fazer a criação das tabelas da aplicação, no banco de dados no cmd (Prompt de comando do Windows) ou Shell na pasta da aplicação. Após será necessário criar as seguintes views no banco de aplicação com as seguintes linhas de sql:
	
- create view vtabelas1 as select tabelas.id_parametro,tabelas.id_configuracao,tabelas.nome,tabelascolunas.id_tabela1,tabelascolunas.id_tabela2,tabelascolunas.coluna1,tabelascolunas.coluna2 from tabelas,tabelascolunas where tabelascolunas.id_tabela1=tabelas.id;
- create view vtabelas2 as select tabelas.id_parametro,tabelas.id_configuracao,tabelas.nome,tabelascolunas.id_tabela1,tabelascolunas.id_tabela2,tabelascolunas.coluna1,tabelascolunas.coluna2 from tabelas,tabelascolunas where tabelascolunas.id_tabela2=tabelas.id;
-	create view vparametros1 as select distinct(parametros.id),parametros.host,parametros.usuario,parametros.senha,parametros.banco from tabelas,tabelascolunas,parametros where tabelascolunas.id_tabela1=tabelas.id and tabelas.id_parametro=parametros.id;
- create view vparametros2 as select distinct(parametros.id),parametros.host,parametros.usuario,parametros.senha,parametros.banco from tabelas,tabelascolunas,parametros where tabelascolunas.id_tabela2=tabelas.id and tabelas.id_parametro=parametros.id;

	Essas views criadas no banco de aplicação é necessária para que a funcionalidade de sincronização seja realizada sem a criação dessas view não ocorrerá sincronização. São as views responsáveis por fornecer os parâmetros necessários para conexão e sincronização das bases de dados conforme configuração final cadastrada.

 Feito esses passos a nossa aplicação já está configurada e pronta para execução. 
	Para acessar a aplicação caso esteja hospedado em servidor web é necessário ter a configuração no arquivo .htaccess, para direcionamento para a pasta public ao acessar a aplicação. 
	Para iniciar a aplicação na pasta da aplicação no cmd (Prompt de comandos do Windows) será necessário rodar o comando:
	  php artisan serve
	  
	Feito todos os passos descritos acessando a página index obterá esta mensagem Laravel, que a rota inicial padrão do Laravel, página não foi removida. O sistema desenvolvido foi definido nas seguintes rotas. 
- admin/configurações; (Primeira etapa da aplicação).
- admin/parametros; (Segunda etapa da aplicação definição dos parâmetros.)
- admin/tabelas; (Terceira etapa da aplicação, configuração das tabelas a serem utilizadas, nas base definidas anteriormente na rota admin/parâmetros).
- /ajax-tabela; (Rota função javascript usando ajax que busca tabelas de acordo com seleção de banco e retorna um json com nomes tabelas do banco.)
- admin/vinculotabelas; (Etapa onde se vincula quais tabelas de bancos de dados distintos serão vinculadas para sincronização de dados.)
- admin/tabelascolunas; (Etapa de definição de quais colunas irão ter sua sincronização entre a coluna da tabela a qual está vinculada.)
- admin/tarefas; (Etapa de definição das tarefas. Esta etapa é onde define as tarefas de sincronização, que poderá ser definida a partir de 5 em 5 minutos. Nesta rota possui a sub rota /show  é onde é realizada a tarefa de sincronização, rota a qual será programada no servido para que rode o comando automaticamente que irá sincronizar as bases de dados. 
Exemplo de comado que irá rodar:  php www.site.com/ admin/tarefas/1, este comado será definido caso seja um servidor Linux uma cron job que irá fazer a leitura da página da configuração correspondente, de acordo com as definições definidas, fazendo que execute a sincronização dos dados no tempo agendado, conforme as configurações definidas para a tarefa. Sabendo que uma tarefa corresponde a uma configuração, com no mínimo 2 dois parâmetros (host, usuário, senha, banco), no mínimo duas tabelas vinculada e no mínimo uma coluna vinculada com uma coluna de parâmetro diferente. Ou seja, uma coluna não pode ser vinculada com outra coluna que pertença ao mesmo banco de dados.
Para cada uma das rotas existe uma sub rota /create, /show, /update e index. Cada sub rota corresponde à criação, exibição que no lugar da palavra show é o equivalente a chave primária da tabela do modulo, atualização e o índice do modulo. O arquivo routes.php, localizado na pasta \App\Http\routes.php do projeto, contém todas as rotas neste arauivo, já as sub rotas estão definidas nos arquivos controller de cada rota correspondente na pasta \App\Http\Controllers onde cada arquivo corresponde a uma herança da classe Controller localizado na pasta \ App\Http\Controllers\Controller; Existe os seguintes métodos nestas classes: index, create, store, update, show, edit e destroy. 

Com o aplicativo Web Cloud rodando é hora de fazer a configuração dos bancos de dados no qual se deseja que sincronize dados entre si, para a primeira etapa, só é necessário nomear a configuração. 

Após a definição do nome para a configuração, é necessário a configuração dos parâmetros que são os dados relacionados ao banco de dados. São eles o host, ou seja, o endereço IP remoto de onde está localizado o banco de dados, os dados de usuário e senha, e selecionar em qual das configurações estes parâmetros irão pertencer. 
 
Realizada corretamente a criação dos parâmetros de configurações relacionadas aos bancos que se deseja trabalhar. Na próxima etapa são listadas as tabelas existentes nos bancos para que o usuário selecione quais tabelas serão vinculadas. Na imagem 10 é demonstrado as telas de inclusão, visualização e com a opções relacionadas ao cadastro das tabelas que irão ser posteriormente vinculada com qual tabela da base distinta pretende manter sincronizada.
As telas de cadastro e alteração ou exclusão das tabelas quais serão utilizadas, sabendo que cada tabela pertença a um parâmetro de uma mesma configuração. Conforme pode ser observado a tela de cadastro possui uma função javascript utilizando ajax que de acordo com o parâmetro escolhido, na caixa de seleção seguinte é apresentado as opções relacionadas à tabela e parâmetro selecionados.

Configurada todas as tabelas as quais desejam se vincular é necessário fazer os vínculos relacionadas as colunas das tabelas definindo quais os campos irão sincronizar com qual campo, afim de obter uma relação, para que seja criada a rotina de sincronização relacionada a configuração criada.
As telas na qual são feitas os vínculos entre as tabelas na tela de visualização das tabelas vinculadas possui em uma das ações o link para configuração de quais colunas serão vinculadas com quais colunas nas tarefas de sincronização das bases de dados trabalhadas. Para testes foi configurada duas bases de dados.
Após feitos os vinculo é necessário configurar cada um clicando no link vincular colunas ao clicar o usuário é direcionado para a tela de cadastro de vínculos de colunas relacionado à configuração selecionada neste caso usando a configuração de número 1 vinculando as tabelas de número 1 com a de número 2 que correspondem a tabelas cadastradas anteriormente e possuem um vínculo agora é necessário as configurações relacionadas a quais campos das tabelas correspondem a quais campos da outra tabela. As telas que são responsáveis por realizar estes vínculos e após feita esta configuração relacionada aos vínculos de cada colunas das tabelas vinculadas.

	Feita esta configuração para cada campo vinculado gera uma entrada no banco de dados da aplicação contendo a chave primaria da tabela 1 e nome do campo da tabela. Após realização do cadastro destes parâmetros de configuração. Ao acessar a visão que corresponde a essa configuração será disparado a sincronização de acordo com os parâmetros configurados desde o início da descrição de implantação do sistema Web Cloud Desenvolvido para sincronização de dados entre bases de dados distintas.
	Neste caso ao acessar a rota do sistema /admin/configuracoes/1 será realizada toda a sincronização de dados. Para manter as bases sincronizadas é recomendável adicionar uma tarefa agendada no caso de o servidor ao qual ficará hospedado a aplicação para que seja executado o comando curl site/admin/configuracoes/1. 
	A cada vez que for acessada a rota referente ao id da configuração será sincronizado as bases relacionais configuradas. Para que o processo seja automático basta criar uma tarefa agenda no windows para ser disparado na inicializacao do sistema e após criação ou atualização da taferal para rodar o comando curl site/admin/configuracoes/id_da_configuração.
